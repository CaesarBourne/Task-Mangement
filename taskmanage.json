{
  "info": {
    "name": "Task Service Hexagonal API",
    "_postman_id": "b8ad2a4b-6f5f-4e9e-bc8c-hex-task-service-v2",
    "description": "Postman collection to test the hexagonal NestJS Task API (tasks + people + assignments).",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "00 - Create Person (for assignment)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"John Doe\",\n  \"email\": \"john.doe@example.com\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/people",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "people"
          ]
        },
        "description": "Creates a person that will be used when assigning tasks. Stores id in {{personId}}."
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status is 201 or 200\", function () {",
              "  pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
              "});",
              "",
              "pm.test(\"Body has id\", function () {",
              "  const json = pm.response.json();",
              "  pm.expect(json).to.have.property('id');",
              "  pm.collectionVariables.set('personId', json.id);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "01 - Create Task (valid)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"title\": \"Write API documentation\",\n  \"description\": \"Document the Task Service endpoints\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/tasks",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "tasks"
          ]
        },
        "description": "Creates a new task. On success, stores the task id in {{taskId}} for subsequent requests."
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status is 201 or 200\", function () {",
              "  pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
              "});",
              "",
              "pm.test(\"Body has id\", function () {",
              "  const json = pm.response.json();",
              "  pm.expect(json).to.have.property('id');",
              "  pm.collectionVariables.set('taskId', json.id);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "02 - List Tasks (all)",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/tasks",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "tasks"
          ]
        },
        "description": "Returns all tasks."
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status is 200\", function () {",
              "  pm.expect(pm.response.code).to.eql(200);",
              "});",
              "",
              "pm.test(\"Response is array\", function () {",
              "  const json = pm.response.json();",
              "  pm.expect(json).to.be.an('array');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "03 - List Tasks (filtered by status=PENDING)",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/tasks?status=PENDING",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "tasks"
          ],
          "query": [
            {
              "key": "status",
              "value": "PENDING"
            }
          ]
        },
        "description": "Returns tasks filtered by status (PENDING)."
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status is 200\", function () {",
              "  pm.expect(pm.response.code).to.eql(200);",
              "});",
              "",
              "pm.test(\"All tasks (if any) are PENDING\", function () {",
              "  const json = pm.response.json();",
              "  json.forEach(t => {",
              "    pm.expect(t.status).to.eql('PENDING');",
              "  });",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "04 - Update Task (valid)",
      "request": {
        "method": "PATCH",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"title\": \"Write API documentation (updated)\",\n  \"status\": \"IN_PROGRESS\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/tasks/{{taskId}}",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "tasks",
            "{{taskId}}"
          ]
        },
        "description": "Updates the task created in step 01 using {{taskId}}. Changes title and status to IN_PROGRESS."
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status is 200\", function () {",
              "  pm.expect(pm.response.code).to.eql(200);",
              "});",
              "",
              "pm.test(\"Status is updated to IN_PROGRESS\", function () {",
              "  const json = pm.response.json();",
              "  pm.expect(json.status).to.eql('IN_PROGRESS');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "05 - Update Task (not found - 404)",
      "request": {
        "method": "PATCH",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"title\": \"This task does not exist\",\n  \"status\": \"DONE\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/tasks/999999",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "tasks",
            "999999"
          ]
        },
        "description": "Attempts to update a non-existing task (id 999999). Should return 404 according to controller logic."
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status is 404 (Task not found)\", function () {",
              "  pm.expect(pm.response.code).to.eql(404);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "06 - Assign Person to Task (valid)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"personId\": {{personId}}\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/tasks/{{taskId}}/assign",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "tasks",
            "{{taskId}}",
            "assign"
          ]
        },
        "description": "Assigns the person created in 00 ({{personId}}) to the task created in 01 ({{taskId}})."
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status is 200\", function () {",
              "  pm.expect(pm.response.code).to.eql(200);",
              "});",
              "",
              "pm.test(\"Task has assignees array\", function () {",
              "  const json = pm.response.json();",
              "  pm.expect(json).to.have.property('assignees');",
              "  pm.expect(json.assignees).to.be.an('array');",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "07 - Assign Person to Task (person not found - 400)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"personId\": 999999\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/tasks/{{taskId}}/assign",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "tasks",
            "{{taskId}}",
            "assign"
          ]
        },
        "description": "Assigns a non-existing personId (999999). According to controller mapping, this should throw PERSON_NOT_FOUND -> 400 Bad Request."
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status is 400 (Person not found)\", function () {",
              "  pm.expect(pm.response.code).to.eql(400);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "08 - Delete Task",
      "request": {
        "method": "DELETE",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/tasks/{{taskId}}",
          "host": [
            "{{baseUrl}}"
          ],
          "path": [
            "tasks",
            "{{taskId}}"
          ]
        },
        "description": "Deletes the task created in step 01 using {{taskId}}. Delete is idempotent; API returns { success: true } even if task is already missing."
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status is 200\", function () {",
              "  pm.expect(pm.response.code).to.eql(200);",
              "});",
              "",
              "pm.test(\"Response has success true\", function () {",
              "  const json = pm.response.json();",
              "  pm.expect(json).to.have.property('success', true);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000"
    },
    {
      "key": "personId",
      "value": ""
    }
  ]
}